# SLAM
This SLAM implementation leverages the localization module `laser_scan_matcher`. The placing of the cones is performed by mapping the cones' relative positions with respect to the car using its absolute position `pose_stamped` generated by `laser_scan_matcher`.

## Usage

<!-- 
The slam toolbox package can be downloaded at the following link [here](https://github.com/SteveMacenski/slam_toolbox)

It's important to note that the provided toolbox builds the map using a `sensor_msgs::LaserScan` but the LIDAR outputs data of type `sensor_msgs::PointCloud`.

To address this iussue, we transform the point cloud into laser scan using the [`pointclod_to_laserscan package](http://wiki.ros.org/pointcloud_to_laserscan)

The slam toolbox listens for `LaserScan` messages on the topic specified in `slam_toolbox/config` in the param `scan_topic`.
 -->

Hereby follows a concise guide on how to assembly the various components:
```
git clone https://github.com/unipi-smartapp-2021/SLAM
cd SLAM
git submodule update --init --recursive
sudo apt-get install libgsl0-dev
```

If `catkin_make` fails due to missing `csm` package, install it:
```
cd src
git clone https://github.com/AndreaCensi/csm
```

Overwrite the following files (modified the topic in the source code):
```
cp utils/pointcloud_to_laserscan_nodelet.cpp src/pointcloud_to_laserscan/src/pointcloud_to_laserscan_nodelet.cpp
cp utils/sample_node.launch src/pointcloud_to_laserscan/launch/sample_node.launch
cp utils/laser_scan_matcher.cpp src/scan_tools/laser_scan_matcher/src/laser_scan_matcher.cpp
```

Try and pray that everything builds:
```
catkin_make
```

## Example
**Important** You should follow this exact same order in order to succesfully launch the SLAM:
```
roscore
rosrun pointcloud_to_laserscan pointcloud_to_laserscan_node
rosrun cone_mapping cone_mapping.py
rosparam set use_sim_time true

# launch the bag, localization and set the simulation clock
rosbag play <bag> --clock
rosrun laser_scan_matcher laser_scan_matcher_node

# print the output topics
rostopic echo /pose_stamped
rostopic echo /cone_right
rostopic echo /cone_left
```

If you want to plot the cones, you must create a bag recording the topic `/cone_left /cone_right /pose_stamped` and then launch `utils/visualize_cones.py`. Example

![](imgs/track.png)

# TODO
- [] Make launchfile 
- [] Use directly Pointercloud instead of converting to Laserscan
- [] Test on the simulator

<!-- 
## slam-toolbox

**IMPORTANT** before doing anything change the branch to `noetic-devel`

Install dependencies with `rosdep install -q -y -r --from-paths src --ignore-src`

Install `apt install ros-noetic-slam-toolbox` if required.


## pointcloud-to-laserscan

**IMPORTANT** before doing anything change the branch to `lunar-devel`

Notice that `geometry2` is required to build this package. -->
